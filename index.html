<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Vault Pro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app" v-cloak>
  
  <div v-if="toastMsg" class="toast-notify">{{ toastMsg }}</div>

  <div v-if="!currentUser" class="login-screen">
    <div style="width: 100%; max-width: 400px;">
        <h1 class="logo">Vault Pro</h1>
        <input type="email" v-model="loginEmail" placeholder="Email" class="f-input">
        <input type="password" v-model="loginPass" placeholder="Password" class="f-input" @keyup.enter="login">
        <button class="btn-primary" @click="login">Sign In</button>
    </div>
  </div>

  <div v-else class="app-wrapper">
    <header class="main-header">
        <h1 class="fintech-title">{{ currentTab === 'home' ? 'Vault' : currentTab === 'crypto' ? 'Crypto' : currentTab === 'activity' ? 'History' : 'Hub' }}</h1>
        <div class="user-pill">üë§ {{currentUser.name}}</div>
    </header>

    <div class="scroll-content">
        <div v-if="currentTab === 'home'">
            <div class="balance-card">
                <div class="label">CASH WALLET</div>
                <div class="amount">{{ settings.currency }}{{ cashBalance.toFixed(2) }}</div>
                <div class="p-bar"><div class="p-fill" :style="{width: budgetPercent + '%'}"></div></div>
                <div class="balance-grid">
                    <div><small>INCOME</small><div class="plus">+{{totalIncome}}</div></div>
                    <div style="text-align:right"><small>SPENDING</small><div class="minus">-{{totalSpent}}</div></div>
                </div>
            </div>
            <h3 class="section-label">Recent Activity</h3>
            <div v-for="t in userTransactions.slice(0, 10)" :key="t.id" class="t-item" @click="openEdit(t)">
                <div class="t-icon">{{ getEmoji(t.category) }}</div>
                <div class="t-main">
                    <div class="t-cat">{{ t.category }} <span v-if="t.asset" class="t-asset-tag">{{t.asset}}</span></div>
                    <div class="t-sub">{{ t.notes || formatDate(t.date) }}</div>
                </div>
                <div :class="['t-amt', isPositive(t.category) ? 'plus' : '']">{{ settings.currency }}{{ t.amount }}</div>
            </div>
        </div>

        <div v-if="currentTab === 'crypto'">
            <div class="balance-card crypto-card">
                <div class="label">CRYPTO PORTFOLIO</div>
                <div class="amount">History</div>
                <button class="btn-export-mini" @click="exportCryptoCSV">Export Crypto CSV üì•</button>
            </div>
            <div class="crypto-grid">
                <button class="c-btn buy" @click="quickAdd('Crypto Buy')">ü™ô Buy</button>
                <button class="c-btn sell" @click="quickAdd('Crypto Sell')">üìà Sell</button>
            </div>
            <button class="hub-btn-special" style="background: #5856D6; border:none; color:white;" @click="quickAdd('Investment')">üíé Log External Investment</button>

            <h3 class="section-label">Portfolio History</h3>
            <div v-for="t in cryptoTransactions" :key="t.id" class="t-item" @click="openEdit(t)">
                <div class="t-icon">‚Çø</div>
                <div class="t-main">
                    <div class="t-cat">{{ t.category }} <span class="t-asset-tag">{{t.asset}}</span></div>
                    <div class="t-sub">{{ t.notes || formatDate(t.date) }}</div>
                </div>
                <div class="t-amt">{{ settings.currency }}{{ t.amount }}</div>
            </div>
        </div>

        <div v-if="currentTab === 'activity'">
            <div v-for="t in userTransactions" :key="t.id" class="t-item" @click="openEdit(t)">
                <div class="t-icon">{{ getEmoji(t.category) }}</div>
                <div class="t-main">
                    <div class="t-cat">{{ t.category }} <span v-if="t.asset" class="t-asset-tag">{{t.asset}}</span></div>
                    <div class="t-sub">{{ t.notes ? t.notes + ' ‚Ä¢ ' : '' }}{{ formatDate(t.date) }}</div>
                </div>
                <div :class="['t-amt', isPositive(t.category) ? 'plus' : '']">{{ settings.currency }}{{ t.amount }}</div>
            </div>
        </div>

        <div v-if="currentTab === 'more'">
            <button class="hub-btn-special" style="background: #32D74B; border:none; color:white;" @click="quickAdd('Paycheque')">üí∞ Add Paycheque</button>
            <div class="setting-list">
                <div class="s-item" @click="subView = 'budget'"><span>üìä Monthly Budget</span><span class="s-val">{{settings.monthlyBudget}} ‚Ä∫</span></div>
                <div class="s-item" @click="exportCSV"><span>üì• Export Full CSV</span></div>
                <div class="s-item danger" @click="logout">üîê Log Out</div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-btn" :class="{active: currentTab==='home'}" @click="currentTab='home'">üè†</div>
        <div class="nav-btn" :class="{active: currentTab==='activity'}" @click="currentTab='activity'">üßæ</div>
        <button class="fab-btn" @click="openAdd">+</button>
        <div class="nav-btn" :class="{active: currentTab==='crypto'}" @click="currentTab='crypto'">‚Çø</div>
        <div class="nav-btn" :class="{active: currentTab==='more'}" @click="currentTab='more'">‚ãØ</div>
    </nav>
  </div>

  <div v-if="showModal || subView" class="overlay" @click.self="showModal = false; subView = null">
    <div class="sheet">
        <div v-if="showModal">
            <div class="amt-input-wrap">
                <span class="curr">{{ settings.currency }}</span>
                <input type="number" v-model.number="entry.amount" class="amt-input" autofocus>
            </div>
            <input type="text" v-model="entry.notes" class="f-input" placeholder="Notes / Description" style="margin-bottom:12px;">
            <input v-if="entry.category.includes('Crypto')" type="text" v-model="entry.asset" class="f-input" placeholder="e.g. BTC" style="text-align:center">
            
            <div class="cat-grid">
                <div v-for="c in allCategories" :key="c" :class="['cat-pill', entry.category === c ? 'active' : '']" @click="entry.category = c">{{getEmoji(c)}} {{c}}</div>
            </div>
            <button class="btn-primary" @click="saveEntry">Save</button>
            <button v-if="isEditing" @click="deleteTransaction" class="btn-delete">Delete</button>
        </div>
        <div v-if="subView === 'budget'">
            <h2 style="text-align:center">Budget</h2>
            <input type="number" v-model.number="settings.monthlyBudget" class="huge-input">
            <button class="btn-primary" @click="subView = null">Done</button>
        </div>
    </div>
  </div>
</div>
<script type="module" src="app.js"></script>
</body>
</html>
