<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Vault Pro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app">
  
  <div v-if="!currentUser" class="login-screen">
    <div class="login-box">
        <h1 class="logo">Vault Pro</h1>
        <input type="email" v-model="loginEmail" placeholder="Email" class="f-input">
        <input type="password" v-model="loginPass" placeholder="Password" class="f-input" @keyup.enter="login">
        <button class="btn-primary" @click="login">Sign In</button>
    </div>
  </div>

  <div v-else class="app-wrapper" v-cloak>
    <header class="main-header">
        <h1 class="fintech-title">{{ currentTab === 'home' ? 'My Vault' : currentTab === 'activity' ? 'My History' : currentTab === 'insights' ? 'My Stats' : 'Hub' }}</h1>
        <div class="user-pill">{{currentUser.emoji}} {{currentUser.name}}</div>
    </header>

    <div class="scroll-content">
        <div v-if="currentTab === 'home'">
            <div class="balance-card">
                <div class="label">PERSONAL BALANCE</div>
                <div class="amount">{{ settings.currency }}{{ (totalIncome - totalSpent).toFixed(2) }}</div>
                <div class="p-bar"><div class="p-fill" :style="{width: budgetPercent + '%'}"></div></div>
                <div class="balance-grid">
                    <div><small>MY INCOME</small><div class="plus">+{{totalIncome}}</div></div>
                    <div style="text-align:right"><small>MY SPENT</small><div class="minus">-{{totalSpent}}</div></div>
                </div>
            </div>
            <h3 class="section-label">Your Recent</h3>
            <div v-for="t in userTransactions.slice(0, 5)" :key="t.id" class="t-item" @click="openEdit(t)">
                <div class="t-icon">{{ t.category[0] }}</div>
                <div class="t-main"><div class="t-cat">{{ t.category }}</div><div class="t-sub">{{ formatDate(t.date) }}</div></div>
                <div :class="['t-amt', t.category === 'Paycheque' ? 'plus' : '']">{{ settings.currency }}{{ t.amount }}</div>
            </div>
        </div>

        <div v-if="currentTab === 'activity'">
            <div v-for="t in userTransactions" :key="t.id" class="t-item" @click="openEdit(t)">
                <div class="t-icon">{{ t.category[0] }}</div>
                <div class="t-main"><div class="t-cat">{{ t.category }}</div><div class="t-sub">{{ formatDate(t.date) }}</div></div>
                <div :class="['t-amt', t.category === 'Paycheque' ? 'plus' : '']">{{ settings.currency }}{{ t.amount }}</div>
            </div>
        </div>

        <div v-if="currentTab === 'insights'">
            <div class="insight-grid">
                <div class="card insight-card">
                    <small>MY DAILY AVG</small>
                    <div class="stat-big">{{settings.currency}}{{dailyAvg}}</div>
                </div>
                <div class="card insight-card">
                    <small>FORECAST</small>
                    <div class="stat-big">{{settings.currency}}{{forecast}}</div>
                </div>
            </div>
            <div class="card" style="margin-top:15px;">
                <h4 style="margin:0 0 15px 0">Personal Breakdown</h4>
                <div v-for="stat in categoryStats" :key="stat.name" class="breakdown-row">
                    <div class="breakdown-info">
                        <span class="dot" :style="{background: stat.color}"></span>
                        <span class="cat-name">{{stat.name}}</span>
                        <span class="cat-total">{{settings.currency}}{{stat.total}}</span>
                    </div>
                    <div class="mini-bar-bg"><div class="mini-bar-fill" :style="{width: stat.percent + '%', background: stat.color}"></div></div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'more'">
            <div class="hub-btn-special" @click="addPaychequeDirect">üí∞ Add Paycheque</div>
            <div class="setting-list">
                <div class="s-item" @click="subView = 'budget'"><span>üìä Personal Budget</span><span class="s-val">{{settings.monthlyBudget}} ‚Ä∫</span></div>
                <div class="s-item" @click="subView = 'categories'"><span>üè∑Ô∏è Categories</span><span class="s-val">Edit ‚Ä∫</span></div>
                <div class="s-item" @click="exportCSV"><span>üì• Export My Data</span></div>
                <div class="s-item danger" @click="logout">üîê Log Out</div>
            </div>
            <div style="text-align: center; margin-top: 20px; opacity: 0.2; font-size: 10px;">Build {{version}}</div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-btn" :class="{active: currentTab==='home'}" @click="currentTab='home'">üè†</div>
        <div class="nav-btn" :class="{active: currentTab==='activity'}" @click="currentTab='activity'">üßæ</div>
        <button class="fab-btn" @click="openAdd">+</button>
        <div class="nav-btn" :class="{active: currentTab==='insights'}" @click="currentTab='insights'">üìä</div>
        <div class="nav-btn" :class="{active: currentTab==='more'}" @click="currentTab='more'">‚ãØ</div>
    </nav>
  </div>

  <div v-if="showModal" class="overlay" @click.self="showModal = false">
    <div class="sheet">
        <div v-if="isSaving" class="success-overlay">‚úÖ Saved to Cloud</div>
        <div v-else class="form-container">
            <div class="sheet-header"><span>{{ isEditing ? 'Edit' : 'New' }} Transaction</span><span @click="showModal = false">‚úï</span></div>
            <div class="amount-entry">
                <span class="currency-symbol">{{ settings.currency }}</span>
                <input type="number" v-model.number="entry.amount" class="pro-input" autofocus>
            </div>
            <div class="category-scroller">
                <div v-for="c in ['Paycheque', ...settings.expenseCats]" :key="c" 
                     :class="['pro-pill', entry.category === c ? 'pro-active' : '']" @click="entry.category = c">
                    {{c}}
                </div>
            </div>
            <button class="btn-primary" @click="saveEntry">Confirm</button>
            <button v-if="isEditing" @click="deleteTransaction" class="btn-link-danger">Delete</button>
        </div>
    </div>
  </div>

  <div v-if="subView" class="overlay" @click.self="subView = null">
    <div class="sheet">
        <h2 style="text-align:center">{{ subView === 'budget' ? 'Personal Budget' : 'Categories' }}</h2>
        <input v-if="subView === 'budget'" type="number" v-model.number="settings.monthlyBudget" class="huge-input">
        <div v-if="subView === 'categories'">
            <div v-for="(cat, i) in settings.expenseCats" :key="i" class="s-item">{{cat}} <span @click="removeCategory(i)" class="danger">‚úï</span></div>
            <input type="text" v-model="newCatName" placeholder="Add New..." class="f-input" @keyup.enter="addCategory">
        </div>
        <button class="btn-primary" @click="subView = null">Save</button>
    </div>
  </div>

</div>
<script type="module" src="app.js"></script>
</body>
</html>
